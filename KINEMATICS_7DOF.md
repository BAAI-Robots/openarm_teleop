# OpenArm 7-DOF运动学配置说明

## 机器人配置

**OpenArm v10 Follower（无手指版）**
- **自由度**: 7-DOF（7个旋转关节）
- **关节配置**: 7个revolute关节（无单独gripper关节）
- **运动学**: 冗余机械臂（7-DOF求解6-DOF位姿）

## 关节详情

### 右臂关节（控制臂）
1. `openarm_right_joint1` - 基座旋转（Z轴）
2. `openarm_right_joint2` - 肩部俯仰（X轴，带旋转）
3. `openarm_right_joint3` - 肘部旋转（Z轴）
4. `openarm_right_joint4` - 腕部俯仰（Y轴）
5. `openarm_right_joint5` - 腕部旋转（Z轴）
6. `openarm_right_joint6` - 腕部横滚（X轴）
7. `openarm_right_joint7` - 腕部俯仰（Y轴）

### 左臂关节（仅显示）
- `openarm_left_joint1~7` - 保持零位（不控制）

## 运动学求解器

### 正向运动学（FK）
- **算法**: KDL递归求解器
- **输入**: 7个关节角度
- **输出**: 末端执行器位姿（位置+姿态）
- **求解时间**: ~0.1ms

### 逆向运动学（IK）
- **算法**: KDL LMA（Levenberg-Marquardt Algorithm）
- **输入**: 末端执行器目标位姿（6-DOF: xyz + 姿态）
- **输出**: 7个关节角度（冗余解）
- **参数配置**:
  - `maxiter=500` - 最大迭代次数
  - `eps=1e-5` - 位置收敛阈值（0.01mm）
  - `eps_joints=1e-5` - 关节收敛阈值
- **求解时间**: 1-5ms
- **成功率**: 约80-90%（取决于目标位姿）

## IK失败原因

### 常见失败场景
1. **奇异点附近**: 关节配置接近奇异姿态
2. **工作空间边界**: 目标位置超出可达范围
3. **姿态约束冲突**: 目标姿态无法通过关节组合实现
4. **局部最小值**: LMA陷入局部最优解

### 错误代码
- `-101`: IK求解失败（未收敛）
- `-3`: 关节限位违反
- 其他: KDL内部错误

### 提高成功率的方法
1. **平滑轨迹**: 小步长连续移动而非跳跃
2. **避免极限姿态**: 保持远离工作空间边界
3. **初始猜测**: 使用当前关节位置作为初始值（已实现）
4. **重试机制**: 失败时可尝试不同初始猜测

## 冗余自由度优势

7-DOF臂相比6-DOF的优势：
1. **避障能力**: 可以在保持末端位姿的同时调整肘部位置
2. **奇异点规避**: 更容易绕过奇异配置
3. **灵活性**: 一个末端位姿对应多个关节解
4. **工作空间**: 更大的可达空间

## 性能基准测试

```bash
# 运行IK测试
python3.10 test_7dof_ik.py
```

**典型测试结果**:
- 测试次数: 20次
- 成功次数: 16-18次
- 成功率: 80-90%
- 平均求解时间: 2-3ms

## 工作空间限制

### 位置范围（相对于`openarm_right_link0`）
- **X**: -0.1 ~ 0.3 m
- **Y**: -0.4 ~ 0.0 m
- **Z**: 0.1 ~ 0.5 m

### 姿态限制
- 所有关节有限位（见URDF）
- 避免极限配置以提高IK成功率

## 与MoveIt对比

### 当前实现（KDL）
✅ 优点:
- 轻量级，无需额外依赖
- 快速求解（1-5ms）
- 纯Python接口
- 适合实时控制

⚠️ 限制:
- 无碰撞检测
- 无轨迹规划
- 成功率80-90%

### MoveIt（可选扩展）
✅ 优点:
- 碰撞检测
- 轨迹规划
- 多种IK求解器（KDL, TRAC-IK, etc.）
- 更高成功率（95%+）

⚠️ 缺点:
- 重量级框架
- 配置复杂
- 求解时间较长（10-50ms）

## 参考资料

- [KDL文档](http://www.orocos.org/kdl)
- [PyKDL教程](https://github.com/orocos/orocos_kinematics_dynamics)
- OpenArm URDF: `~/ros2_ws/src/openarm_description/urdf/robot/v10.urdf.xacro`
