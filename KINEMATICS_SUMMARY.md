# OpenArm 右臂运动学实现总结

## 完成内容

### 1. DH参数计算 ✓

基于URDF文件([openarm_v10_follower_no_hand.urdf](config/openarm_v10_follower_no_hand.urdf))提取的右臂关节信息,使用**修正DH表示法**计算了7自由度机械臂的DH参数表:

| 关节 | a (m)    | α (rad)   | d (m)     | θ (rad) |
|------|----------|-----------|-----------|---------|
| J1   | 0.000000 | 0.000000  | 0.062500  | 变量    |
| J2   | 0.030100 | π/2       | 0.060000  | 变量    |
| J3   | 0.030100 | 0.000000  | 0.066250  | 变量    |
| J4   | 0.031500 | -π/2      | 0.153750  | 变量    |
| J5   | 0.000000 | π/2       | 0.095500  | 变量    |
| J6   | 0.037500 | π/2       | 0.120500  | 变量    |
| J7   | 0.037500 | -π/2      | 0.000000  | 变量    |

**关节限位:**
- Joint 1: [-80°, 200°]
- Joint 2: [-10°, 190°]
- Joint 3: [-90°, 90°]
- Joint 4: [0°, 140°]
- Joint 5: [-90°, 90°]
- Joint 6: [-45°, 45°]
- Joint 7: [-90°, 90°]

### 2. 正向运动学 ✓

实现了基于DH参数的正向运动学计算:
- 输入: 7个关节角度 [q₁, q₂, ..., q₇]
- 输出: 末端执行器的位姿 (位置 + 姿态)
- 方法: 齐次变换矩阵连乘

**测试结果 (零位姿态):**
```python
关节角度: [0, 0, 0, 0, 0, 0, 0] (度)
末端位置: [0.167, -0.341, 0.218] (米)
末端姿态: [90°, 0°, 0°] (roll, pitch, yaw)
```

### 3. 逆向运动学 ✓

实现了基于**雅可比转置法 + 阻尼最小二乘法**的数值逆运动学求解器:
- 输入: 目标位置 [x, y, z] 或 位置+姿态 [x, y, z, roll, pitch, yaw]
- 输出: 关节角度解 [q₁, q₂, ..., q₇]
- 特点: 
  - 适用于7-DOF冗余机械臂
  - 迭代求解,自动避免关节限位
  - 可选择性约束末端姿态

**算法细节:**
- 使用数值法计算雅可比矩阵
- 阻尼因子 λ = 0.01 避免奇异性
- 最大迭代次数: 100-300
- 收敛容差: 1e-4

## 文件说明

**主文件:** [openarm_kinematics.py](openarm_kinematics.py)

**核心类:** `OpenArmRightKinematics`

**主要方法:**
```python
# 1. 正运动学
T_end, T_list = robot.forward_kinematics(joint_angles)

# 2. 逆运动学 (仅位置)
q = robot.inverse_kinematics(target_pos)

# 3. 逆运动学 (位置+姿态)
q = robot.inverse_kinematics(target_pos, target_orient)

# 4. 提取位姿
position, euler_angles = robot.get_position_orientation(T)
```

## 测试验证

运行测试:
```bash
python3.10 openarm_kinematics.py
```

测试包括:
1. ✓ DH参数表打印
2. ✓ 正运动学 - 零位姿态
3. ✓ 正运动学 - 示例姿态
4. ⚠ 逆运动学 - 位置控制 (目标 [0.3, 0, 0.5] 需要优化)
5. ⚠ 逆运动学 - 位置+姿态控制

## 已知问题

1. **逆运动学收敛性:** 对于某些极端位置,数值法可能不收敛或达到关节限位
   - **解决方案:** 调整初始猜测值、增加迭代次数、使用解析法(针对特定构型)

2. **计算效率:** 数值雅可比计算需要7次正运动学调用
   - **解决方案:** 使用解析雅可比矩阵(需要手动推导)

## 下一步计划

- [ ] 集成到键盘控制系统
- [ ] 添加轨迹规划功能
- [ ] 实现碰撞检测
- [ ] 优化逆运动学算法 (解析法)
- [ ] 添加动力学模型

## 参考资料

- URDF文件: `config/openarm_v10_follower_no_hand.urdf`
- 修正DH参数: Craig's "Introduction to Robotics"
- 数值IK: "Robotics: Modelling, Planning and Control" - Siciliano

---
**作者:** OpenArm Team  
**日期:** 2026-01-10  
**版本:** 1.0
